// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/* ---------- ENUMS ---------- */
enum MatchStatus {
  PENDING
  ACCEPTED
  REJECTED
}

/* ---------- MODELS ---------- */
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  profile   Profile?

  roles     UserRole[]

  sentMatches     Match[] @relation("MatchOwner")
  receivedMatches Match[] @relation("MatchSitter")

  kennelMemberships KennelMember[]
  
  sentMessages Message[]
}

model Role {
  id   Int        @id @default(autoincrement())
  name String     @unique
  users UserRole[]
}

model UserRole {
  userId Int
  roleId Int

  user User @relation(fields: [userId], references: [id])
  role Role @relation(fields: [roleId], references: [id])

  @@id([userId, roleId])
  @@unique([userId, roleId])
}

/* ---------- PROFILE ---------- */
model Profile {
  id               Int    @id @default(autoincrement())
  firstName        String?
  lastName         String?
  bio              String?
  location         String?
  dogBreed         String?
  servicesOffered  String?
  user             User   @relation(fields: [userId], references: [id])
  userId           Int    @unique
}

/* ---------- MATCH ---------- */
model Match {
  id        Int         @id @default(autoincrement())
  ownerId   Int
  sitterId  Int
  status    MatchStatus @default(PENDING)

  owner     User        @relation("MatchOwner", fields: [ownerId], references: [id])
  sitter    User        @relation("MatchSitter", fields: [sitterId], references: [id])

  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  messages Message[]

  @@unique([ownerId, sitterId])
}

/* ---------- KENNEL (future-proof) ---------- */
model Kennel {
  id          Int            @id @default(autoincrement())
  name        String
  location    String?
  members     KennelMember[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

model KennelMember {
  kennelId Int
  userId   Int
  role     String         // e.g. "owner", "employee", "manager"

  kennel   Kennel @relation(fields: [kennelId], references: [id])
  user     User   @relation(fields: [userId], references: [id])

  @@id([kennelId, userId])
}

/* ---------- MESSAGE ---------- */
model Message {
  id        Int      @id @default(autoincrement())
  matchId   Int
  senderId  Int
  message   String
  timestamp DateTime @default(now())

  match     Match    @relation(fields: [matchId], references: [id])
  sender    User     @relation(fields: [senderId], references: [id])

  @@index([matchId, timestamp])
}